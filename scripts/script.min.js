function getElementDelay(el,variableName="--delay"){const value=el.style.getPropertyValue(variableName)||"0",parsed=parseInt(value,10);return isNaN(parsed)?0:parsed}const RESIZE_DEBOUNCE_DELAY=300,MENU_CLOSE_ANIMATION_DURATION=400;let resizeTimeout;const lenis=new Lenis({duration:1,easing:t=>Math.min(1,1.001-Math.pow(2,-10*t)),smooth:!0,smoothTouch:!0});function refreshLenis(){clearTimeout(resizeTimeout),resizeTimeout=setTimeout((()=>{requestAnimationFrame((()=>{lenis.resize()}))}),300)}function lenisScroll(){requestAnimationFrame((function raf(time){lenis.raf(time),requestAnimationFrame(raf)}))}function setActiveLink(selector){const links=document.querySelectorAll(`${selector} a`);function applyOpacity(hoveredLink=null){links.forEach((link=>{link.style.opacity=hoveredLink?link===hoveredLink?"1":"0.3":"1"}))}links.forEach((link=>{link.addEventListener("mouseenter",(()=>applyOpacity(link))),link.addEventListener("mouseleave",(()=>applyOpacity()))})),applyOpacity()}function menuToggle(){const hamburger=document.getElementById("hamburger"),menu=document.getElementById("menu"),overlay=document.getElementById("menu__overlay"),navLinks=document.querySelectorAll(".main-menu li"),socialLinks=document.querySelectorAll(".menu__social--links a"),logo=document.querySelector(".menu__logo");if(!hamburger||!menu||!overlay)return;const isMenuOpen=()=>menu.classList.contains("show");function setVisible(visible){hamburger.classList.toggle("active",visible),menu.classList.toggle("show",visible),overlay.classList.toggle("show",visible),document.body.classList.toggle("ov-hidden",visible),logo?.classList.toggle("visible",visible),visible?lenis.stop():lenis.start();[...navLinks,...socialLinks].forEach(((link,i)=>{visible?setTimeout((()=>link.classList.add("visible")),100*i):link.classList.remove("visible")}))}function toggleMenu(){isMenuOpen()?(menu.classList.add("closing"),setVisible(!1),setTimeout((()=>menu.classList.remove("closing")),MENU_CLOSE_ANIMATION_DURATION)):setVisible(!0)}hamburger.addEventListener("click",toggleMenu),overlay.addEventListener("click",(()=>isMenuOpen()&&toggleMenu())),[...navLinks,logo].forEach((el=>{el?.addEventListener("click",(()=>isMenuOpen()&&toggleMenu()))})),window.closeMenuOnBack=()=>{isMenuOpen()&&toggleMenu()}}function fadeInElements(){const observer=new IntersectionObserver(((entries,observer)=>{entries.forEach((entry=>{entry.isIntersecting&&(entry.target.classList.add("visible"),observer.unobserve(entry.target))}))}));document.querySelectorAll(".fade-upNone").forEach((el=>{observer.observe(el)}))}function blurScrollEffect(){const elements=document.querySelectorAll(".blur-scroll");function wrapLetters(node){const fragment=document.createDocumentFragment();return node.childNodes.forEach((child=>{if(child.nodeType===Node.TEXT_NODE&&""!==child.textContent.trim()){child.textContent.split(/(\s+)/).forEach((word=>{const wordSpan=document.createElement("span");wordSpan.style.display="inline-block",wordSpan.style.whiteSpace="nowrap";for(const char of word){const span=document.createElement("span");span.classList.add("letter"),span.setAttribute("data-final",char),span.style.display="inline-block",span.style.width="1ch",span.style.textAlign="center",span.style.opacity="0",span.style.transition="opacity 0.3s ease",span.style.backfaceVisibility="hidden",span.style.transform="translateZ(0)",wordSpan.appendChild(span)}fragment.appendChild(wordSpan)}))}else if(child.nodeType===Node.ELEMENT_NODE){const clone=child.cloneNode(!1),wrapped=wrapLetters(child);clone.appendChild(wrapped),fragment.appendChild(clone)}else fragment.appendChild(child.cloneNode(!0))})),fragment}elements.forEach((el=>{const wrapped=wrapLetters(el);el.innerHTML="",el.appendChild(wrapped)}));const observer=new IntersectionObserver((entries=>{entries.forEach((entry=>{if(entry.isIntersecting){const spans=entry.target.querySelectorAll("span.letter"),baseDelay=getElementDelay(entry.target);spans.forEach(((span,index)=>{const delay=baseDelay+100*index,originalChar=span.getAttribute("data-final");setTimeout((()=>{!function(span,finalChar){let iterations=0;const scrambleInterval=setInterval((()=>{if(iterations>=5)return clearInterval(scrambleInterval),span.textContent=finalChar,void(span.style.opacity="1");span.textContent="abcdefghijklmnopqrstuvwxyz".charAt(Math.floor(26*Math.random())),span.style.opacity="1",iterations++}),30)}(span,originalChar)}),delay)})),observer.unobserve(entry.target)}}))}),{threshold:.4});elements.forEach((el=>observer.observe(el)))}function staggerFade(){document.querySelectorAll(".stagger-fade").forEach((header=>{const childNodes=Array.from(header.childNodes),newContent=document.createDocumentFragment();childNodes.forEach((node=>{if(node.nodeType===Node.TEXT_NODE){node.textContent.split(/(\s+)/).forEach((part=>{if(""===part.trim())newContent.appendChild(document.createTextNode(part));else{const span=document.createElement("span");span.textContent=part,newContent.appendChild(span)}}))}else newContent.appendChild(node.cloneNode(!0))})),header.innerHTML="",header.appendChild(newContent);const spans=header.querySelectorAll("span"),delay=getElementDelay(header),observer=new IntersectionObserver((([entry])=>{entry.isIntersecting&&setTimeout((()=>{spans.forEach(((span,i)=>{span.style.transitionDelay=`${delay+100*i}ms`})),header.classList.add("visible"),observer.unobserve(header)}),delay)}),{threshold:.5});observer.observe(header)}))}function wrapLetters(node){const fragment=document.createDocumentFragment();return node.childNodes.forEach((child=>{if(child.nodeType===Node.TEXT_NODE&&""!==child.textContent.trim()){child.textContent.split(/(\s+)/).forEach((part=>{if(""===part.trim())fragment.appendChild(document.createTextNode(part));else{const wordSpan=document.createElement("span");wordSpan.style.whiteSpace="nowrap",part.split("").forEach((char=>{const charSpan=document.createElement("span");charSpan.textContent=char,wordSpan.appendChild(charSpan)})),fragment.appendChild(wordSpan)}}))}else if(child.nodeType===Node.ELEMENT_NODE){const clone=child.cloneNode(!1),wrapped=wrapLetters(child);clone.appendChild(wrapped),fragment.appendChild(clone)}else fragment.appendChild(child.cloneNode(!0))})),fragment}function hoverBlurGlobal(){applyHoverBlurToElements(document.querySelectorAll("#content .blur"))}function hoverBlurHeader(){applyHoverBlurToElements(document.querySelectorAll("#header .blur"))}function hoverBlurFooter(){applyHoverBlurToElements(document.querySelectorAll("#footer .blur"))}function applyHoverBlurToElements(elements){const scrambleChars="abcdefghijklmnopqrstuvwxyz";elements.forEach((el=>{Array.from(el.childNodes).forEach((node=>{if((node.nodeType!==Node.ELEMENT_NODE||"SPAN"!==node.tagName&&!node.querySelector)&&node.nodeType===Node.TEXT_NODE&&""!==node.textContent.trim()){const fragment=document.createDocumentFragment();node.textContent.split("").forEach((char=>{const span=document.createElement("span");span.textContent=char,span.dataset.originalChar=char,span.style.display="inline-block",fragment.appendChild(span)})),el.replaceChild(fragment,node)}})),el.addEventListener("mouseenter",(()=>{el.querySelectorAll("span").forEach(((span,i)=>{const original=span.dataset.originalChar;let frame=0;span.classList.add("flash"),setTimeout((()=>span.classList.remove("flash")),150),span.textContent=scrambleChars[Math.floor(26*Math.random())];const interval=setInterval((()=>{frame<2*i?span.textContent=scrambleChars[Math.floor(26*Math.random())]:(span.textContent=original,clearInterval(interval)),frame++}),30)}))}))}))}function hoverImage(){const hoverImage=document.querySelector(".hover-image"),hoverItems=document.querySelectorAll(".hover-item");if(!hoverImage||0===hoverItems.length)return;let hideTimeout=null;hoverItems.forEach((item=>{item.addEventListener("mouseenter",(()=>{const imgSrc=item.dataset.img;imgSrc&&hoverImage&&(hoverImage.src=imgSrc,hoverImage.onload=()=>{const row=item.querySelector(".awards__table--row");if(!row)return;const rect=row.getBoundingClientRect(),scrollY=window.scrollY||document.documentElement.scrollTop,imageWidth=hoverImage.offsetWidth,imageHeight=hoverImage.offsetHeight;hoverImage.style.left=.7*window.innerWidth-imageWidth/2+"px",hoverImage.style.top=rect.top+scrollY+rect.height/2-imageHeight/2+"px",hoverImage.classList.add("visible")},hideTimeout&&(clearTimeout(hideTimeout),hideTimeout=null))})),item.addEventListener("mouseleave",(()=>{hideTimeout=setTimeout((()=>{document.querySelector(".hover-item:hover")||(hoverImage.classList.remove("visible"),setTimeout((()=>{hoverImage.src=""}),300)),hideTimeout=null}),50)}))}))}function toggleTheme(){function updateThemeColor(theme){const meta=document.querySelector('meta[name="theme-color"]');if(!meta)return;const color="dark"===theme?"#121212":"#e2ebe9";meta.setAttribute("content",color)}const toggleButtons=document.querySelectorAll(".toggle-theme");let currentTheme=localStorage.getItem("theme")||"light";document.documentElement.setAttribute("data-theme",currentTheme),localStorage.setItem("theme",currentTheme),updateThemeColor(currentTheme),toggleButtons.forEach((btn=>{btn.addEventListener("click",(()=>{const newTheme="light"===document.documentElement.getAttribute("data-theme")?"dark":"light";document.documentElement.setAttribute("data-theme",newTheme),localStorage.setItem("theme",newTheme),updateThemeColor(newTheme)}))}))}function loader(){const loader=document.querySelector("#loader"),grid=document.querySelector(".loader-grid");if(!loader)return;let squareSize;squareSize=window.innerWidth<=480?60:window.innerWidth<=768?100:120;const totalSquares=Math.ceil(window.innerWidth/squareSize)*Math.ceil(window.innerHeight/squareSize);grid.innerHTML="";const percentageEl=document.querySelector(".loader-percentage");let percent=0;const percentageInterval=setInterval((()=>{percent++,percentageEl.textContent=`${percent}%`,percent>=100&&clearInterval(percentageInterval)}),15);for(let i=0;i<totalSquares;i++){const square=document.createElement("div");square.classList.add("square"),grid.appendChild(square)}setTimeout((()=>{const stroke=document.querySelector(".n-stroke"),fill=document.querySelector(".n-fill"),svg=document.querySelector(".svg1"),percent=document.querySelector(".loader-percentage");stroke?.classList.add("animate-stroke"),fill?.classList.add("animate-fill"),setTimeout((()=>{svg?.classList.add("fade-out"),percent?.classList.add("fade-out"),setTimeout((()=>{svg?.classList.add("hidden"),percent?.classList.add("hidden")}),600)}),2500)}),100);setTimeout((()=>{grid.querySelectorAll(".square").forEach((square=>{const delay=300*Math.random();setTimeout((()=>{square.classList.add("fade-out")}),delay)})),document.body.classList.remove("body-loading"),document.getElementById("site").style.display=""}),3e3),setTimeout((()=>{loader.remove()}),3800)}function fadeHero(){window.addEventListener("scroll",(()=>{const hero=document.querySelector(".hero"),scrollY=window.scrollY,fadeEnd=window.innerHeight/1.5;if(!hero)return;const opacity=1-Math.min(Math.max((scrollY-0)/(fadeEnd-0),0),1);hero.style.opacity=opacity}))}function fillCircleWithSquares(){const circle=document.querySelector(".hero__round--bg-circle"),circleGrid=document.querySelector(".circle-grid");if(!circle||!circleGrid)return;circleGrid.style.display="grid",circleGrid.style.gridTemplateColumns="repeat(10, 1fr)",circleGrid.style.gridTemplateRows="repeat(10, 1fr)";let maxDelay=0;for(let i=0;i<100;i++){const square=document.createElement("div");square.classList.add("square");const delay=500*Math.random();maxDelay=Math.max(maxDelay,delay),setTimeout((()=>{square.classList.add("visible")}),delay),circleGrid.appendChild(square)}setTimeout((()=>{circle.style.backgroundColor="#76f085",circle.innerHTML=""}),maxDelay+800)}function runFillCircleWithLoaderCheck(){const loader=document.querySelector("#loader"),runCircle=()=>fillCircleWithSquares();if(loader&&!loader.classList.contains("hidden")){setTimeout(runCircle,2500+500+300)}else runCircle()}function runAfterLoader(callback){const loader=document.querySelector("#loader");if(!loader||loader.classList.contains("hidden")||!document.body.contains(loader))return void callback();const observer=new MutationObserver((()=>{!loader.classList.contains("hidden")&&document.body.contains(loader)||(observer.disconnect(),callback())}));observer.observe(loader,{attributes:!0,childList:!0,subtree:!0})}function workSlider(){const slider=document.querySelector(".slider"),slides=slider?slider.querySelectorAll(".slide"):[],prevBtn=document.getElementById("prev"),nextBtn=document.getElementById("next"),currentSlideEl=document.getElementById("current-slide"),totalSlidesEl=document.getElementById("total-slides");if(!slider||0===slides.length)return;let prevClone,nextClone,index=0;function updateSlider(){slider.style.transform=`translateX(-${100*index}%)`,slides.forEach(((slide,i)=>{slide.classList.toggle("active",i===index)})),prevBtn&&nextBtn&&(prevClone.classList.toggle("disabled",0===index),nextClone.classList.toggle("disabled",index===slides.length-1)),currentSlideEl&&(currentSlideEl.textContent=index+1),totalSlidesEl&&(totalSlidesEl.textContent=slides.length)}prevBtn&&nextBtn&&(prevClone=prevBtn.cloneNode(!1),prevClone.innerHTML=prevBtn.innerHTML,nextClone=nextBtn.cloneNode(!1),nextClone.innerHTML=nextBtn.innerHTML,prevBtn.replaceWith(prevClone),nextBtn.replaceWith(nextClone),prevClone.addEventListener("click",(()=>{index>0&&(index--,updateSlider())})),nextClone.addEventListener("click",(()=>{index<slides.length-1&&(index++,updateSlider())})));let startX=0,startY=0,isSwiping=!1;slider.addEventListener("touchstart",(e=>{startX=e.touches[0].clientX,startY=e.touches[0].clientY,isSwiping=!1}),{passive:!0}),slider.addEventListener("touchmove",(e=>{const deltaX=e.touches[0].clientX-startX,deltaY=e.touches[0].clientY-startY;Math.abs(deltaX)>Math.abs(deltaY)&&(isSwiping=!0,e.preventDefault())}),{passive:!1}),slider.addEventListener("touchend",(e=>{if(!isSwiping)return;const deltaX=e.changedTouches[0].clientX-startX;Math.abs(deltaX)>50&&(deltaX<0&&index<slides.length-1?index++:deltaX>0&&index>0&&index--,updateSlider())})),updateSlider(),window.addEventListener("resize",updateSlider)}function buildPixelGrid(container,fixedCols=10,fixedRows=10){const grid=container.querySelector(".pixel-grid");if(!grid||"true"===grid.dataset.built)return;const width=container.offsetWidth,height=container.offsetHeight;if(0===width||0===height)return!1;grid.style.display="grid",grid.style.gridTemplateColumns=`repeat(${fixedCols}, 1fr)`,grid.style.gridTemplateRows=`repeat(${fixedRows}, 1fr)`,grid.innerHTML="";for(let i=0;i<fixedCols*fixedRows;i++){const square=document.createElement("div");square.classList.add("pixel-square"),grid.appendChild(square)}return grid.dataset.built="true",!0}function setupPixelReveal(container){if(buildPixelGrid(container))return;const resizeObserver=new ResizeObserver((()=>{buildPixelGrid(container)&&resizeObserver.disconnect()}));resizeObserver.observe(container)}function fadeOutPixels(container){const grid=container.querySelector(".pixel-grid");if(!grid)return;const squares=grid.querySelectorAll(".pixel-square");let completed=0;squares.forEach((square=>{const delay=300*Math.random();setTimeout((()=>{square.classList.add("fade-out"),square.addEventListener("transitionend",(()=>{completed++,completed===squares.length&&grid.remove()}),{once:!0})}),delay)}))}function observePixelReveals(){const observer=new IntersectionObserver(((entries,obs)=>{entries.forEach((entry=>{entry.isIntersecting&&(fadeOutPixels(entry.target),obs.unobserve(entry.target))}))}),{threshold:.3});document.querySelectorAll(".pixel-reveal").forEach((el=>observer.observe(el)))}function videoPlay(){const videos=document.querySelectorAll("video[autoplay]"),observer=new IntersectionObserver((entries=>{entries.forEach((entry=>{const video=entry.target;entry.isIntersecting?video.play():video.pause()}))}),{threshold:.5});videos.forEach((video=>observer.observe(video)))}function contactBtn(){document.querySelectorAll(".contact-btn").forEach((btn=>{function copyEmail(){btn.classList.contains("copied")||navigator.clipboard.writeText("mccaffrey.nolan@gmail.com").then((()=>{btn.classList.add("copied"),setTimeout((()=>{btn.classList.remove("copied")}),5e3)}))}btn.addEventListener("click",copyEmail),btn.addEventListener("touchend",(e=>{e.preventDefault(),copyEmail()}),{passive:!1})}))}function cursorLabel(){const label=document.getElementById("cursorLabel"),targets=document.querySelectorAll(".work__list--item-content-img.cursor--label");window.matchMedia("(hover: hover)").matches&&(document.addEventListener("mousemove",(e=>{label.style.left=`${e.clientX+10}px`,label.style.top=`${e.clientY+10}px`})),targets.forEach((el=>{el.addEventListener("mouseenter",(()=>{label.style.opacity=1})),el.addEventListener("mouseleave",(()=>{label.style.opacity=0}))})))}function videoToggle(){document.querySelectorAll(".pixel-reveal").forEach((wrapper=>{const video=wrapper.querySelector(".video"),toggleButton=wrapper.querySelector(".video-toggle");if(!video||!toggleButton)return;const playIcon=toggleButton.querySelector(".icon-play"),pauseIcon=toggleButton.querySelector(".icon-pause");playIcon&&pauseIcon&&toggleButton.addEventListener("click",(()=>{video.paused?(video.play(),playIcon.style.display="none",pauseIcon.style.display="block"):(video.pause(),playIcon.style.display="block",pauseIcon.style.display="none")}))}))}function pixelCursor(){if(window.matchMedia("(pointer: coarse)").matches)return;const grid=document.querySelector(".cursor-grid");if(!grid||"true"===grid.dataset.built)return;let cols;cols=window.innerWidth<=480?12:window.innerWidth<=768?20:35;const squareSize=window.innerWidth/cols,rows=Math.ceil(window.innerHeight/squareSize);grid.style.setProperty("--cols",cols),grid.style.setProperty("--rows",rows),grid.style.pointerEvents="none",grid.dataset.built="true";const squares=[],squareRects=[];let resizeTimeout,lastHoveredIndex=-1;for(let i=0;i<cols*rows;i++){const square=document.createElement("div");square.classList.add("cursor-square"),grid.appendChild(square),squares.push(square)}function cacheRects(){squares.forEach(((square,index)=>{const rect=square.getBoundingClientRect();squareRects[index]={left:rect.left,right:rect.right,top:rect.top,bottom:rect.bottom}}))}requestAnimationFrame(cacheRects),window.addEventListener("resize",(()=>{clearTimeout(resizeTimeout),resizeTimeout=setTimeout((()=>{cacheRects()}),200)}));let lastMove=0;window.addEventListener("mousemove",(e=>{const now=performance.now();if(now-lastMove<16)return;lastMove=now;const{clientX:clientX,clientY:clientY}=e;for(let i=0;i<squares.length;i++){const rect=squareRects[i];if(rect&&(clientX>=rect.left&&clientX<=rect.right&&clientY>=rect.top&&clientY<=rect.bottom)){if(lastHoveredIndex!==i){const square=squares[i];square.style.opacity=1,clearTimeout(square.fadeTimeout),square.fadeTimeout=setTimeout((()=>{square.style.opacity=0}),300),lastHoveredIndex=i}break}}}))}function setupAjaxNavigation(){const contentEl=document.querySelector("#content");function normalizeUrl(url){const a=document.createElement("a");return a.href=url,a.protocol+"//"+a.host+a.pathname.replace(/\/index\.html$/,"/")}async function loadPage(url){contentEl.classList.add("fade-out"),await new Promise((resolve=>setTimeout(resolve,500)));const res=await fetch(url),html=await res.text(),newDoc=(new DOMParser).parseFromString(html,"text/html"),newContent=newDoc.querySelector("#content");contentEl.innerHTML=newContent.innerHTML,contentEl.classList.remove("fade-out"),function(newDoc){const newHead=newDoc.head,currentHead=document.head;["title",'meta[name="description"]','meta[name="application-name"]','link[rel="canonical"]','link[rel="preload"]','meta[property^="og:"]','meta[name^="twitter:"]'].forEach((selector=>{currentHead.querySelectorAll(selector).forEach((el=>el.remove())),newHead.querySelectorAll(selector).forEach((newEl=>{currentHead.appendChild(newEl.cloneNode(!0))}))}));const newBodyId=newDoc.body.id;newBodyId&&(document.body.id=newBodyId)}(newDoc),void 0!==lenis&&lenis.scrollTo(0,{immediate:!0}),initAnimations();const hashIndex=url.indexOf("#");if(-1!==hashIndex){const hash=url.substring(hashIndex+1),targetEl=document.getElementById(hash);targetEl&&targetEl.scrollIntoView({behavior:"smooth"})}}document.addEventListener("click",(e=>{const link=e.target.closest("a[data-link]");if(!link)return;const url=link.href,hash=url.includes("#")?url.split("#")[1]:null,currentUrl=normalizeUrl(window.location.href),linkUrl=normalizeUrl(url);if(e.preventDefault(),linkUrl===currentUrl&&hash){e.preventDefault();const targetEl=document.getElementById(hash);targetEl?targetEl.scrollIntoView({behavior:"smooth"}):"home"===hash&&window.scrollTo({top:0,behavior:"smooth"})}else loadPage(url),history.pushState(null,"",url)})),window.addEventListener("popstate",(()=>{loadPage(location.href)}))}function loadHeader(){return fetch("/utilities/header.html").then((response=>response.text())).then((html=>{document.getElementById("header").innerHTML=html}))}function loadFooter(){return fetch("/utilities/footer.html").then((response=>response.text())).then((html=>{document.getElementById("footer").innerHTML=html}))}function initComponents(){lenisScroll(),fadeHero()}function initHeaderComponents(){menuToggle(),setActiveLink("#main-menu"),toggleTheme(),contactBtn(),hoverBlurHeader()}function initAnimations(){fadeInElements(),blurScrollEffect(),workSlider(),hoverBlurGlobal(),cursorLabel(),videoToggle(),hoverImage(),staggerFade(),document.querySelectorAll(".pixel-reveal").forEach(setupPixelReveal),observePixelReveals(),videoPlay(),pixelCursor();const label=document.getElementById("cursorLabel");label&&(label.style.opacity=0),void 0!==lenis&&(lenis.resize(),requestAnimationFrame((time=>lenis.raf(time)))),"homepage"===document.body.id&&runFillCircleWithLoaderCheck()}window.addEventListener("load",refreshLenis),document.addEventListener("DOMContentLoaded",(()=>{loader(),initComponents(),setupAjaxNavigation(),loadFooter().then((()=>{hoverBlurFooter(),setActiveLink(".footer__nav")})).catch((err=>console.error("Failed to load footer:",err))),loadHeader().then((()=>{requestAnimationFrame((()=>{initHeaderComponents(),initAnimations()}))})).catch((err=>console.error("Failed to load header:",err)))})),window.addEventListener("load",(()=>{Promise.all([document.fonts.ready,new Promise((r=>requestAnimationFrame(r))),new Promise((r=>setTimeout(r,150)))]).then((()=>{document.body.classList.remove("body-loading")}))}));